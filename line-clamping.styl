/**
 * @author     Zino Roman <zino.roman95@gmail.com>
 * @copyright  Zino Roman 2017 
 */
 
/**
 * Mixin for clamping multiline text
 * @param {number} $lines-count - Count of the lines that will be shown
 * @param {css unit} $font-size - font-size property of the element
 * @param {css unit} $line-height - line-height property of the element
 * @param {boolean} $is-inline - Parameter sets inline display mode for the element
 */
line-clamping($lines-count = 1, $font-size = 16px, $line-height = 1.25, $is-inline = false)        
    line-clamping-get-display()
        /* Remember the fact, that you should set `width` of the element
        when you are using inline display mode */
        if $is-inline
            inline-block
        else
            block
    
    line-clamping-get-display-webkit()
        if $is-inline
            -webkit-inline-box 
        else
            -webkit-box
        
    line-clamping-calculate-max-height()
        /* Unitless, percents or ems units require
         a different strategy of calculation than all other units */
        $line-height-unit = unit($line-height)
        
        if $line-height-unit == ''  or $line-height-unit  == '%' or $line-height-unit == 'em'
            $line-height-computed = $line-height
            
            if $line-height-unit == '%'
                //Divide $line-height in percents by 100 for correct further calculation
                $line-height-computed = $line-height / 100
        
            /*
                Remove units from $line-height to avoid potential error
                when $line-height and $font-size have differents CSS units
            */
            $line-height-computed = unit($line-height-computed, '')
            
            //Calculate our `max-height`
            $max-height = $lines-count * ($line-height-computed * $font-size)
        else
            $max-height = $lines-count * $line-height
    
    preInit()
        if $lines-count < 1
            error('$lines-count parameter should be greater then 0')
    
    /**
     * @param {string} $display
     */
    lineClampingStrategyOneLine($display)
        /* If we need only one line of the text,
        then better way is to use `text-overflow: ellipsis`
        cause it has wider support */
        display $display
        overflow hidden
        text-overflow ellipsis
        white-space nowrap
    
    /**
     * @param {string} $display
     * @param {string} $display-webkit
     */
    lineClampingStrategyFewLine($display, $display-webkit)
        //Rules for IE, Edge, Firefox
        display $display
        max-height line-clamping-calculate-max-height($lines-count, $font-size, $line-height)
        overflow hidden
        font-size $font-size
        line-height $line-height
        
        //Rules for webkit browser
        @supports (display $display-webkit) and (-webkit-line-clamp $lines-count)
            display $display-webkit
            -webkit-box-orient vertical
            -webkit-line-clamp $lines-count

    findLineClampingStrategyAndPrintRules()
        //Mixin implementation
        $display = line-clamping-get-display($is-inline)
        $display-webkit = line-clamping-get-display-webkit($is-inline)

        if $lines-count == 1
            lineClampingStrategyOneLine($display)
        else        
            lineClampingStrategyFewLine($display, $display-webkit)
                
    init()
        preInit()     
        findLineClampingStrategyAndPrintRules()
                
    init()